## 云原生时代下，容器安全的“四个挑战”和“两个关键”

#### 名词解释

云原生：

* CNCF：云原生计算基金会，2015年由谷歌牵头成立，基金会成员目前已有一百多企业与机构，包括亚马逊、微软。思科等巨头。托管了许多应用。
* 云原生应用的三个特征：
  1. 容器化封装：以容器为基础，简化云中应用的维护。容器中运行程序/进程，实现高水平隔离。
  2. 动态管理：集中式的调度系统来管理&调度容器。
  3. 面向Microservice：明确服务之间的依赖，互相解耦。（例如网页的前后端分属两个容器）
* 云原生意味着应用的编写、调试、维护、链接适合部署在云端，或者从生到死都基于云（？）



**容器化封装**

Docker让开发工程师可以将他们的应用和依赖封装到一个可移植的容器中。Docker背后的想法是创建软件程序可移植的轻量容器，让其可以在任何安装了Docker的机器上运行，而不用关心底层操作系统。

Docker可以解决虚拟机能够解决的问题。也可以解决因为虚拟机太笨重所以解决不了的问题。

- 隔离应用依赖
- 创建应用镜像并进行复制
- 创建容易分发的即启即用的应用
- 允许实例简单、快速地扩展
- 测试应用并随后销毁它们

自动化运维工具降低环境搭建的复杂性，但是环境一迁移就草了。docker就无这个问题。



**服务编排**

Kubernetes牛逼！

**微服务架构**

传统的开发方式：单体架构，打包在一个WAR包里。没有外部依赖。

微服务架构的理解：把功能模块或者系统进行分解，保证这些任务在容器中独立运行，放到各个不同的子模块中。



#### 云原生进程中的容器安全挑战

容器化的安全问题：隔离的缺陷

* 缺少体系化的容器安全能力建设。传统划分安全边界：内部架构不同的信任域；容器化的安全边界？如何在零信任的安全模型下构建企业级容器安全体系？（有没有一个对应的namespace?）上云后企业需要在互联网数据中心/云上部署和交互，无物理安全边界（有的话还可以网关搞一手）
* 更多的攻击面：容器部署依赖于linux内核namespaces和cgroup特性。针对linux、容器、容器部署机制的逃逸和越权
* 缺少应用侧全生命周期的安全防护手段。应用的生命周期缩短了！基础设施能力提升是的容器越来越多，应用部署密度增大，面向VM的防护策略和报警方式不够了。
* 缺少云上安全责任共担模型的理解。上云后的安全需要责任共担，企业管理者和云的运维需要理解企业和云的边界。云服务商也需要设计一些保障安全的实践东西或者提升易用性，降低使用门槛



#### 构建容器安全体系的基本原则

1. 云服务供给侧：构建安全稳定的容器基础平台，面向容器应用构建全生命周期的安防手段。有下列原则：

   **保证容器管控平台的基础设施层的默认安全**

   * 完备的平台安全能力：例如防ddos，账号的访问控制，VPC私有云，SLB负载均衡的访问控制
   * 版本更新和漏洞应急响应：虚拟机OS的版本和漏洞补丁的安装能力可以保证基础设施安全。
   * 平台的安全合规性：金融企业和政府部门上云的前提条件。云服务商需要基于业界通用的安全合规标准，保证服务组件配置的默认安全性。

   **面向容器应用侧的纵深防御能力**

   ​	面向负载，提供云原生场景下的容器应用安全防护手段。要求：全生命周期！

   

2. 企业安全侧

理清楚一点：云上安全的责任边界是什么？企业侧的安全架构需要遵循零信任的安全模型，基于认证和授权重构访问控制构建信任基础。

几个加固企业应用生命周期安全性的做法：

* 应用制品的供应链安全。云原生制品多样性增强。例如容器镜像、helm charts是常见的制品格式。应用构建阶段保证制品的安全性、制品入库、分发、部署时刻建立对应的访问控制、安全扫描、审计、准入校验等机制。
* 权限配置和凭证下发遵循权限最小化原则。云厂商提供相应的访问控制能力，严格遵循最小化原则配置访问控制策略；严格控制资源访问凭证的下发，对于可能越权的行为进行吊销凭证；避免容器模板的过大权限。
* 应用数据和runtime的安全：配备完备的资源请求审计之外，还需要利用厂商提供的运行时刻监控报警。企业应用自身的敏感数据需要对应的加密，用云上的密钥管理方案、落盘加密、机密计算等能力，保证传输和落盘链路上的安全性。
* 及时修复安全漏洞和版本更新。



#### 端到端的云原生容器安全架构

平台侧安全能力：访问控制、密钥管理、日志审计和告警。

应用构建阶段：企业使用可信镜像、最小化镜像；云端发现镜像漏洞、安全扫描、完整性校验；

应用部署阶段：k8s admission机制。root启动容器、敏感目录挂载、滥用特权容器是逃逸攻击的跳板。

应用运行阶段：运维、监控、



感想：似乎是内鬼难防？